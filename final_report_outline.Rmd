---
title: "Final Report Outline"
author: "Joshua Harasaki, Tiffany Chiang, Katie Huynh"
date: "2/15/2022"
output: 
  html_document:
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(tidyverse)
library(tidyr)
library(ggplot2)
library(cluster)
library(caret)
```

## Introduction

The purpose of this project is to see if we can cluster customers based on demographic, behavioral, and lifestyle data.

## Overview of Data Set

This data is collected from a marketing campaign from an unspecified company.

Our data set includes data on customer demographic, amount spent on each type of product, campaign engagement, and where purchases were made.

Here is the link to our data set on kaggle:

<https://www.kaggle.com/imakash3011/customer-personality-analysis>

#### Types of Variables We Are Working With:

**People**

-   ID: Customer's unique identifier

-   Year_Birth: Customer's birth year

-   Education: Customer's education level

-   Marital_Status: Customer's marital status

-   Income: Customer's yearly household income

-   Kidhome: Number of children in customer's household

-   Teenhome: Number of teenagers in customer's household

-   Dt_Customer: Date of customer's enrollment with the company

-   Recency: Number of days since customer's last purchase

-   Complain: 1 if the customer complained in the last 2 years, 0 otherwise

**Products**

-   MntWines: Amount spent on wine in last 2 years

-   MntFruits: Amount spent on fruits in last 2 years

-   MntMeatProducts: Amount spent on meat in last 2 years

-   MntFishProducts: Amount spent on fish in last 2 years

-   MntSweetProducts: Amount spent on sweets in last 2 years

-   MntGoldProds: Amount spent on gold in last 2 years

**Promotion**

-   NumDealsPurchases: Number of purchases made with a discount

-   AcceptedCmp1: 1 if customer accepted the offer in the 1st campaign, 0 otherwise

-   AcceptedCmp2: 1 if customer accepted the offer in the 2nd campaign, 0 otherwise

-   AcceptedCmp3: 1 if customer accepted the offer in the 3rd campaign, 0 otherwise

-   AcceptedCmp4: 1 if customer accepted the offer in the 4th campaign, 0 otherwise

-   AcceptedCmp5: 1 if customer accepted the offer in the 5th campaign, 0 otherwise

-   Response: 1 if customer accepted the offer in the last campaign, 0 otherwise

**Place**

-   NumWebPurchases: Number of purchases made through the company's website

-   NumCatalogPurchases: Number of purchases made using a catalogue

-   NumStorePurchases: Number of purchases made directly in stores

-   NumWebVisitsMonth: Number of visits to company's website in the last month

```{r}
data = read.csv('data/unprocessed/marketing_campaign.csv', sep = '\t')  # load the data
head(data, 10)
```

## Data Cleaning & EDA

```{r}
count(data)
```

There are 2240 rows in this dataset

```{r}
apply(is.na(data), 2, sum)
```

From the output above, we see that the Income column contains 24 missing values. The rest of the columns contain no missing values.

Since 24 missing values is small compared to our total 2240 rows in our dataset, we are going to remove these rows that contain missing values.

```{r}
data <- data %>% filter(complete.cases(data))
data
```

```{r}
count(data)
```

Now, we have 2216 observations in our dataset.

### Now let's explore each segment of the dataset

#### People

We want to be able to find the unique values in each of the categorical features in our dataset.

Here is the total count of each category under "Education".

```{r}
count(data, data["Education"], sort = TRUE)
```

```{r}
ggplot(data, aes(Education, fill = Education)) +
  labs(title = 'Histogram for Education') +
  geom_bar()
```

Let's simplify Education by creating only 3 unique values in this column.

```{r}
# convert "2n Cycle" and "Basic" to "Undergraduate"
data["Education"][data["Education"] == "2n Cycle" | 
                    data["Education"] == "Basic"] <- "Undergraduate"
# convert "Graduation" to "Graduate"
data["Education"][data["Education"] == "Graduation"] <- "Graduate"
# convert "Master" and PhD to "Postgrad"
data["Education"][data["Education"] == "Master" | data["Education"] == "PhD"] <- "Postgrad"
# print new counts for Marital_Status column
count(data, data["Education"], sort = TRUE)
```

Let's count the number of observations per category in "Martial_Status" as well.

```{r}
count(data, data["Marital_Status"], sort = TRUE)
```

Since "Absurd" and "YOLO" aren't useful to us under this feature, we are going to remove these rows.

```{r}
data <- data[!(data$Marital_Status == "YOLO" | data$Marital_Status == "Absurd"),]
data
```

Let's create two unique elements in Marital_Status

```{r}
# convert "Together" to "Married"
data["Marital_Status"][data["Marital_Status"] == "Together"] <- "Married"
# convert "Alone", "Divorced", and "Widow" to "Single"
data["Marital_Status"][data["Marital_Status"] == "Alone" |
                         data["Marital_Status"] == "Divorced" |
                         data["Marital_Status"] == "Widow"] <- "Single"
# print new counts for Marital_Status column
count(data, data["Marital_Status"], sort = TRUE)
```

When were our customer's born?

```{r}
ggplot(data, aes(Year_Birth)) +
  labs(title = 'Distribution of Birth Years of Cusomters') +
  geom_histogram(binwidth = 2)
```

```{r}
sprintf("Oldest Birth Year: %s", min(data$Year_Birth))
sprintf("Latest Birth Year: %s", max(data$Year_Birth))
```

```{r}
# identifies the rows that contain the outliers for Year_Birth
data[data$Year_Birth < 1920,]
```

Let's remove these outliers.

```{r}
data <- data[!(data$Year_Birth < 1920),]
data
```

The dataset contains 2209 rows now.

#### More Univariate Analysis

```{r}

```

#### More Feature Engineering

```{r}
# Create column for total spending
data["Total_Spending"] <- data["MntWines"] + data["MntFruits"] + data["MntMeatProducts"] + 
                          data["MntFishProducts"] + data["MntSweetProducts"] +  
                          data["MntGoldProds"]
head(data)
```

Remove the individual columns for amount spent on each product.

```{r}
del_amts <- c("MntWines", "MntFruits", "MntMeatProducts", "MntFishProducts", 
              "MntSweetProducts", "MntGoldProds")
data <- data[,!(names(data) %in% del_amts)]
head(data)
```

Create age column from Year_Birth. Here we are assuming that we got this data from the year 2018.

```{r}
data["Age"] <- 2018 - data["Year_Birth"]
data <- data[,!(names(data) == "Year_Birth")]
head(data)
```

Replace the "KidHome" and "Teenhome" columns with a column representing the total number of children at home.

```{r}
data["Children"] <- data["Kidhome"] + data["Teenhome"]
data <- data[,!(names(data) == "Kidhome" | names(data) == "Teenhome")]
head(data)
```

Create a column for the total number of purchases.

```{r}
data["TotalNumPurchases"] <- data["NumWebPurchases"] + data["NumCatalogPurchases"] +
                            data["NumStorePurchases"] + data["NumDealsPurchases"]
del_NumPurchases <- c("NumWebPurchases", "NumCatalogPurchases", "NumStorePurchases",
                      "NumDealsPurchases")
data <- data[,!(names(data) %in% del_NumPurchases)]
head(data)
```

```{r}
unique(data["Z_CostContact"])
```

```{r}
unique(data["Z_Revenue"])
```

Delete "Z_CostContact" and "Z_Revenue" because it only has one unique value.

```{r}
data <- data[,!(names(data) == "Z_CostContact" | names(data) == "Z_Revenue")]
head(data)
```

Delete other unimportant columns for performing dimension reduction and clustering

```{r}
del_unimp <- c("ID", "Dt_Customer")
data <- data[,!(names(data) %in% del_unimp)]
head(data)
```

Delete the complain column.

```{r}
data <- data[,!(names(data) == "Complain")]
```

Create a column for the total number of accepted promotions

```{r}
data["TotalAcceptedCmp"] <- data["AcceptedCmp1"] + data["AcceptedCmp2"] + 
                            data["AcceptedCmp3"] + data["AcceptedCmp4"] + 
                            data["AcceptedCmp5"] + data["Response"]
del_accep_cmp <- c("AcceptedCmp1", "AcceptedCmp2", "AcceptedCmp3", "AcceptedCmp4", 
                   "AcceptedCmp5", "Response")
data <- data[,!(names(data) %in% del_accep_cmp)]
head(data)
```

## Dimension Reduction

First, we have to label encode the categorical variables.

```{r}
# convert "Undergraduate" to 0
data["Education"][data["Education"] == "Undergraduate"] <- 0
# convert "Graduate" to 1
data["Education"][data["Education"] == "Graduate"] <- 1
# convert "Postgrad" to 2
data["Education"][data["Education"] == "Postgrad"] <- 2
# convert string values to numeric values
data$Education <- strtoi(data$Education)
# print table of Education values
table(data$Education)
```

```{r}
data$Marital_Status <- ifelse(data$Marital_Status == "Married", 1, 0)
table(data$Marital_Status)
```

Next, scale the dataframe

```{r}
scaled_data = data.frame(scale(data, center = TRUE, scale = TRUE))
head(scaled_data)
```

Create a column for the total number of accepted promotions

```{r}
data["TotalAcceptedCmp"] <- data["AcceptedCmp1"] + data["AcceptedCmp2"] + 
                            data["AcceptedCmp3"] + data["AcceptedCmp4"] + 
                            data["AcceptedCmp5"] + data["Response"]
del_accep_cmp <- c("AcceptedCmp1", "AcceptedCmp2", "AcceptedCmp3", "AcceptedCmp4", 
                   "AcceptedCmp5", "Response")
data <- data[,!(names(data) %in% del_accep_cmp)]
head(data)
```

## Dimension Reduction

First, we have to label encode the categorical variables.

```{r}
# convert "Undergraduate" to 0
data["Education"][data["Education"] == "Undergraduate"] <- 0
# convert "Graduate" to 1
data["Education"][data["Education"] == "Graduate"] <- 1
# convert "Postgrad" to 2
data["Education"][data["Education"] == "Postgrad"] <- 2
# convert string values to numeric values
data$Education <- strtoi(data$Education)
# print table of Education values
table(data$Education)
```

```{r}
data$Marital_Status <- ifelse(data$Marital_Status == "Married", 1, 0)
table(data$Marital_Status)
```

Next, scale the dataframe

```{r}
scaled_data = data.frame(scale(data, center = TRUE, scale = TRUE))
head(scaled_data)
```

```{r}
write.csv(scaled_data, './Data/processed/marketing_campaign_clustering.csv', row.names = FALSE)
```

## Dimensionality Reduction

```{r}
clus_data = read.csv("./Data/processed/marketing_campaign_clustering.csv")
head(clus_data)
```

```{r}

```

## Exploratory Data Analysis

## 
